"VARorder" <- function(x,maxp=12,output=T){# Compute the AIC valuesx1=as.matrix(x)T=nrow(x1)k=ncol(x1)ksq=k*ks=cov(x1)olsdet=rep(0,(maxp+1))olsdet[1]=log(det(s))chidet=olsdetchidet[1]=log(det(s*((T-1)/T)))if(maxp < 1) maxp=max(1,2*floor(log(T)))aic=rep(0,(maxp+1))aic[1]=olsdet[1]bic=aichq=aicfor (p in 1:maxp){idm=k*p+1ne=T-pist=p+1y=x1[ist:T,]xmtx=cbind(rep(1,ne),x1[p:(T-1),])if(p > 1){for (i in 2:p){xmtx=cbind(xmtx,x1[(ist-i):(T-i),])}}y=as.matrix(y)xmtx=as.matrix(xmtx)xpx = t(xmtx)%*%xmtxxpxinv=solve(xpx)xpy=t(xmtx)%*%ybeta=xpxinv%*%xpyyhat=xmtx%*%betaresi=y-yhatsse=(t(resi)%*%resi)/ne#print(paste("For p = ",p,"residual variance is", sse))d1=log(det(sse))aic[p+1]=d1+(2*p*ksq)/Tbic[p+1]=d1+(log(T)*p*ksq)/Thq[p+1]=d1+(2*log(log(T))*p*ksq)/Tolsdet[p+1]=d1chidet[p+1]=log(det(sse*(ne/T)))}maic=min(aic)aicor=c(1:(maxp+1))[aic==maic]-1mbic=min(bic)bicor=c(1:(maxp+1))[bic==mbic]-1mhq=min(hq)hqor=c(1:(maxp+1))[hq==mhq]-1Mstat=rep(0,maxp)pv=rep(0,maxp)for (j in 1:maxp){Mstat[j]=(T-k-j-1-1.5)*(chidet[j]-chidet[j+1])pv[j]=1-pchisq(Mstat[j],ksq)}if(output){cat("selected order: aic = ",aicor,"\n")cat("selected order: bic = ",bicor,"\n")cat("selected order: hq = ",hqor,"\n")cat("M statistic and its p-value","\n")tmp=cbind(Mstat,pv)print(tmp,digits=4)}VARorder<-list(aic=aic,aicor=aicor,bic=bic,bicor=bicor,hq=hq,hqor=hqor,Mstat=Mstat,Mpv=pv)}